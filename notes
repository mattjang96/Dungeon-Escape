// == Start Variables == //
var x = 1,
  y = 1,
  columnCount = 10,
  rowCount = 5,
  newPosition = y + " / " + x,
  player = document.getElementById("player"),
  gate = document.getElementById("gate"),
  gateInitialWidth = 5,
  gateInitialDistance = columnCount - gateInitialWidth,
  gateX = Math.floor(Math.random() * gateInitialWidth + gateInitialDistance),
  gateY = Math.floor(Math.random() * rowCount + 1),
  gatePosition = (gate.style.gridArea = gateY + " / " + gateX),
  obstacle = document.getElementById("obstacle"),
  obsX = columnCount - gateInitialWidth,
  obsY = rowCount,
  obsPosition = (obstacle.style.gridArea = obsY + " / " + obsX),
  frames = 500,
  r = setInterval(randMov, frames);
// == End Variables == //

// == Start Listeners == //
document.addEventListener("keyup", right);
document.addEventListener("keyup", left);
document.addEventListener("keyup", up);
document.addEventListener("keyup", down);
// == End Listeners == //

// == Start Functions == //
function randMov() {
  var randDirection = Math.floor(Math.random() * 4 + 1);
  switch (randDirection) {
    case 1: {
      if (obsY < rowCount && newPosition !== obsPosition) {
        obsY++;
      }
      break;
    }
    case 2: {
      if (obsY > 1 && newPosition !== obsPosition) {
        obsY--;
      }
      break;
    }
    case 3: {
      if (obsX < columnCount && newPosition !== obsPosition) {
        obsX++;
      }
      break;
    }
    case 4: {
      if (obsX > 1 && newPosition !== obsPosition) {
        obsX--;
      }
      break;
    }
  }
  obsPosition = obstacle.style.gridArea = obsY + " / " + obsX;
  check();
}

function right(e) {
  if (e.keyCode == 39) {
    if (x < columnCount) {
      x++;
      newPosition = y + " / " + x;
      if (newPosition != obsPosition) {
        player.style.gridArea = newPosition;
      } else {
        x--;
      }
    }
  }
}

function left(e) {
  if (e.keyCode == 37) {
    if (x > 1) {
      x--;
      newPosition = y + " / " + x;
      if (newPosition != obsPosition) {
        player.style.gridArea = newPosition;
      } else {
        x++;
      }
    }
  }
}

function up(e) {
  if (e.keyCode == 38) {
    if (y > 1) {
      y--;
      newPosition = y + " / " + x;
      if (newPosition != obsPosition) {
        player.style.gridArea = newPosition;
      } else {
        y++;
      }
    }
  }
}

function down(e) {
  if (e.keyCode == 40) {
    if (y < rowCount) {
      y++;
      newPosition = y + " / " + x;
      if (newPosition != obsPosition) {
        player.style.gridArea = newPosition;
      } else {
        y--;
      }
    }
  }
}

function check() {
  if (newPosition == obsPosition) {
    clearInterval(r);
    alert("Game Over !");
    var restartGame = confirm("Restart ?");
    if (restartGame) {
      x = 1;
      y = 1;
      newPosition = y + " / " + x;
      gateX = Math.floor(
        Math.random() * gateInitialWidth + gateInitialDistance
      );
      gateY = Math.floor(Math.random() * rowCount + 1);
      gatePosition = gate.style.gridArea = gateY + " / " + gateX;
      obsX = columnCount - gateInitialWidth;
      obsY = rowCount;
      obsPosition = obstacle.style.gridArea = obsY + " / " + obsX;
      player.style.gridArea = newPosition;
      r = setInterval(randMov, frames);
    }
  } else if (newPosition == gatePosition) {
    clearInterval(r);
    alert("Level Complete !");
    var nextLevel = confirm("Next Level ?");
    if (nextLevel) {
      x = 1;
      y = 1;
      newPosition = y + " / " + x;
      gateX = Math.floor(
        Math.random() * gateInitialWidth + gateInitialDistance
      );
      gateY = Math.floor(Math.random() * rowCount + 1);
      gatePosition = gate.style.gridArea = gateY + " / " + gateX;
      obsX = columnCount - gateInitialWidth;
      obsY = rowCount;
      obsPosition = obstacle.style.gridArea = obsY + " / " + obsX;
      player.style.gridArea = newPosition;
      r = setInterval(randMov, frames);
    }
  }
}
// == End Functions == //
